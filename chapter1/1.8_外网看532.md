# 1.8 在外网通过树莓派看532

每当放假，是不是对师大的532依依不舍呢？

根据学校的设定，很多资源只能在校园网内访问，师大vpn虽然能用一部分校园网资源但是学校可能考虑到整体的带宽问题所以限制了vpn用户对532的访问，但是，如果还是想看532怎么办呢？当然还是有办法滴~
这个时候就需要一个叫做代理的工具

什么叫代理呢，签证可以找代理替你办，这样你就不用亲自去了，网络上也一样，当你所在的网络环境不能访问某一资源的时候，就需要别人来帮你这个忙了（不然翻墙是怎么做到的）

使用树莓派可以轻松地帮你做到这一点

首先确保树莓派正常运行在师大校园网内，假设你已经通过校园网的ip（一般172.16打头）登录上了树莓派并让自己的电脑连上了师大vpn(这样才能在外面访问到自己放在师大的树莓派)，我们的教程正式开始~

没用过师大vpn的童鞋可以前往http://vpn.bnu.edu.cn/
下载客户端查看接入教程

这里用到的是一款linux下著名的代理软件，叫squid

以防万一先更新一下软件源，终端下执行
```sudo apt-get update```
更新完之后就安装squid
```sudo apt-get install squid```
安装完之后squid就已经按照默认的配置启动了
通过
```netstat -tlnp```
查看监听的端口可以看见squid默认的3128端口已经打开

但是，这个时候如果你直接把代理设为树莓派的ip地址和该端口，打开网页你会发现并没有访问权限。。。
![image](https://cloud.githubusercontent.com/assets/16276625/21593007/bc3ef0f8-d14d-11e6-9fa6-488c0851d42a.png)
因为squid为了安全起见默认是禁止非本机的用户通过它的代理上网的，只允许localhost连接上它，这个时候当然可以改它的配置文件让它代理你的请求，但是太麻烦（我改了好久也没配置好。。。。）

既然此路行不通我们绕路走就是

它要只代理localhost就让它代理localhost好了

不妨换个思路，先让我们连接上树莓派的另外一个端口，再让树莓派把这个端口的流量通过本地转发到squid代理的3128上

hh,这个时候squid就会把我们的流量当作本地请求了~~（真是佩服自己掩饰不会改配置文件的能力。。。）

怎么做呢？linux下有一款灰常厉害的端口转发软件叫做socat可以帮我们办到这件事

先安装一发
```sudo apt-get install socat```
再执行
```nohup socat -d -d TCP4-LISTEN:8080,reuseaddr,fork TCP4:localhost:3128 &```
就可以了

简单解释一下这条命令，就是监听8080端口，然后把流量转发到本地的3128端口上，nohup 和 & 是为了让它一直执行下去而不会因为终端的断开而退出

然后把电脑的代理（在设置->网络->代理->手动设置代理里面）改为树莓派的ip和刚才设置转发的端口，然后尽情地享受532带来的快感吧。。。。

ps：在校内的话可以用手机开热点模拟外网环境测试


![image](https://cloud.githubusercontent.com/assets/16276625/21593542/34a4f768-d153-11e6-85bc-877ffcd4b647.png)


![image](https://cloud.githubusercontent.com/assets/16276625/21593507/d6872822-d152-11e6-907b-b9c43c839a3e.png)
